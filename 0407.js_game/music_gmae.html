<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            text-align: center;

        }

        #screen {
            margin: auto;
            position: relative;
        }

        #board {
            margin: auto;
            width: 600px;
            height: 50px;
        }

        .scr {
            position: relative;
            width: 150px;
            height: 600px;
            transition: 4s;
            font-size: 30px;
            font-family: 微軟正黑體;
            animation: drop-shadow 5s infinite;
        }

        .btn {
            position: relative;
            width: 150px;
            height: 100px;
            text-align: center;
            transition: 0.5s;
            font-size: 40px;
            font-family: 微軟正黑體;
            animation: drop-shadow 5s infinite;
        }

        .faller {
            width: 150px;
            height: 20px;
            background: gray;
            position: absolute;
            top: 1%;
            animation: box-shadow 20s infinite;
        }

        .judge {
            width: 148px;
            height: 30px;
            position: absolute;
            top: 79%;
            border: rgb(16, 19, 224) solid 1px;
            animation: box-shadow 20s infinite;
            font-size: 20px;
        }

        .click {
            animation: click 0.1s;
        }

        @keyframes click {
            from {
                background: none;
            }

            to {
                background: blanchedalmond;
            }
        }

        @keyframes drop-shadow {
            from {
                filter: drop-shadow(0px 0px 5px rgb(5, 157, 177));
            }

            33% {
                filter: drop-shadow(0px 0px 10px green);
            }

            66% {
                filter: drop-shadow(0px 0px 8px rgb(161, 163, 16));
            }

            100% {
                filter: drop-shadow(0px 0px 5px rgb(77, 141, 4));
            }
        }

        @keyframes box-shadow {
            from {
                box-shadow: 0px 0px 5px rgb(208, 238, 41);
            }

            33% {
                box-shadow: 0px 0px 10px green;
            }

            66% {
                box-shadow: 0px 0px 8px rgb(185, 42, 154);
            }

            100% {
                box-shadow: 0px 0px 5px rgb(35, 170, 194);
            }
        }
    </style>
</head>

<body>
    <table id="screen" border="1px">
        <tr>
            <td class='scr'>
                <div class="judge"></div>
            </td>
            <td class='scr'>
                <div class="judge"></div>
            </td>
            <td class='scr'>
                <div class="judge"></div>
            </td>
            <td class='scr'>
                <div class="judge"></div>
            </td>
            <td class='scr'>
                <div class="judge"></div>
            </td>
            <td class='scr'>
                <div class="judge"></div>
            </td>
        </tr>
        <tr>
            <td class='btn'>A</td>
            <td class='btn'>S</td>
            <td class='btn'>D</td>
            <td class='btn'>4</td>
            <td class='btn'>5</td>
            <td class='btn'>6</td>
        </tr>
        </tr>
    </table>
    <input type="button" value="START" id='start'><br>
    <select id="song">
        <option value="">-------請選擇歌曲-------</option>
        <option value="Undying">Undying</option>

    </select><br>

    目前分數:<span id='score'>0</span>
    COMBO:<span id='comboborad'>0</span>
    <hr>
    名人榜
    <table id='board' border="1">
        <tr>
            <td>名字</td>
            <td>分數</td>
        </tr>
        <tr>
            <td id='hplayerborad'></td>
            <td id='hscoreborad'></td>
        </tr>

    </table>
    <script>

        const start = document.getElementById('start')
        const btns = document.getElementsByClassName('btn')
        const scrs = document.getElementsByClassName('scr')
        const fallers = document.getElementsByClassName('faller')
        const borad = document.getElementById('borad')
        const score = document.getElementById('score')
        const judges = document.getElementsByClassName('judge')
        const comboborad = document.getElementById('comboborad')
        const hplayerborad = document.getElementById('hplayerborad')
        const hscoreborad = document.getElementById('hscoreborad')

        const music = new Audio()
        music.src = "./material/Undying.mp3"

        let keyboard = ['A', 'S', 'D', '4', '5', '6']

        let ingame = false
        let point = 0
        let combo = 0
        let perfect = 0
        let excellent = 0
        let good = 0
        var j = 0




        // START開始-----------------------------------------------------------
        const ready = () => {
            scrs[0].innerText = ('R')
            scrs[1].innerText = ('E')
            scrs[2].innerText = ('A')
            scrs[3].innerText = ('D')
            scrs[4].innerText = ('Y')
            scrs[5].innerText = ('?')
        }
        const clear = () => {
            scrs[0].innerHTML = ('<div class="judge"></div>')
            scrs[1].innerHTML = ('<div class="judge"></div>')
            scrs[2].innerHTML = ('<div class="judge"></div>')
            scrs[3].innerHTML = ('<div class="judge"></div>')
            scrs[4].innerHTML = ('<div class="judge"></div>')
            scrs[5].innerHTML = ('<div class="judge"></div>')
        }

        start.onclick = () => {

            // music.play()
            setTimeout('music.play()', 1250)
            ready()
            setTimeout('clear()', 2500)
            setTimeout('over()', 16000)



            perfect = 0
            excellent = 0
            good = 0
            combo = 0
            point = 0

            run()
            start.disabled = true

        }


        // 滑動方塊------------------------------------------------------------
        const game = (k) => {
            var i = 0
            scrs[k].insertAdjacentHTML('afterbegin', ` <div class="faller" id="A${j}"></div>`)

            let x = document.getElementById(`A${j}`)

            j++

            setInterval(() => {
                x.style.top = `${i}%`
                i++
                if (parseInt(x.style.top) >= 99) {
                    clearInterval()
                    // combo = 0
                    // comboborad.innerText = `${combo}`
                    x.remove()
                }
            }, 12.5)

        }
        // 譜面執行------------------------------------------------------------
        const run = () => {
            let i = 0
            let j = 0
            let k = 0
            let l = 0
            let m = 0
            let n = 0
            while (A[`${i}`] != undefined) {
                setTimeout('game(0)', A[`${i}`])
                i++
            }
            while (S[`${j}`] != undefined) {
                setTimeout('game(1)', S[`${j}`])
                j++
            }
            while (D[`${k}`] != undefined) {
                setTimeout('game(2)', D[`${k}`])
                k++
            }
            while (num4[`${l}`] != undefined) {
                setTimeout('game(3)', num4[`${l}`])
                l++
            }
            while (num5[`${m}`] != undefined) {
                setTimeout('game(4)', num5[`${m}`])
                m++
            }
            while (num6[`${n}`] != undefined) {
                setTimeout('game(5)', num6[`${n}`])
                n++
            }
        }


        // 點擊判斷-------------------------------------------------------------
        const judge = (i) => {

            let last = judges[i].previousElementSibling

            if (last != null) {
                var top = parseInt(last.style.top)
                if (top == 80) {
                    point += 10
                    score.innerText = `${point}`
                    combo++
                    comboborad.innerText = `${combo}`
                    last.remove()
                    perfect++
                    judges[i].innerText = ('perfect')
                    setTimeout(() => {
                        judges[i].innerText = ('')
                    }, 500);
                }
                else if (85 > top && top > 75 && top != 80) {
                    point += 5
                    score.innerText = `${point}`
                    combo++
                    comboborad.innerText = `${combo}`
                    last.remove()
                    excellent++
                    judges[i].innerText = ('excellent')
                    setTimeout(() => {
                        judges[i].innerText = ('')
                    }, 500);
                }
                else if (90 >= top && top >= 85 || 75 >= top && top >= 70) {
                    point += 3
                    score.innerText = `${point}`
                    combo++
                    comboborad.innerText = `${combo}`
                    last.remove()
                    good++
                    judges[i].innerText = ('good')
                    setTimeout(() => {
                        judges[i].innerText = ('')
                    }, 500);
                }
                else {
                    judges[i].innerText = ('miss')
                    combo = 0
                    comboborad.innerText = `${combo}`
                    setTimeout(() => {
                        judges[i].innerText = ('')
                    }, 500)
                }
                if (combo == 10) {
                    point += 5
                    score.innerText = `${point}`
                }
                if (combo == 50) {
                    point += 50
                    score.innerText = `${point}`
                }
                if (combo == 100) {
                    point += 150
                    score.innerText = `${point}`
                }
                if (combo == 150) {
                    point += 300
                    score.innerText = `${point}`
                }
                if (combo == 200) {
                    point += 450
                    score.innerText = `${point}`
                }
                if (combo > 200) {
                    point += 10
                    score.innerText = `${point}`
                }

            }
        }
        //點擊結果-------------------------------------------------------------
        for (let btn of btns) {
            btn.onclick = () => {
                btn.classList.add('click')
                setTimeout(() => {
                    btn.classList.remove('click')
                }, 500);
                let x = btn.innerText
                var i = keyboard.indexOf(`${x}`)
                judge(i)
            }
        }
        // 名人榜---------------------------------------------------------------
        let hscore = { name: '', score: 0 }
        let storage = JSON.parse(localStorage.getItem('hscore'))
        if (storage != null) {

            hscore.name = storage.name
            hscore.score = storage.score

            hscoreborad.innerText = hscore.score
            hplayerborad.innerText = hscore.name

        }
        // over結束-----------------------------------------------------------
        let over = () => {
            start.disabled = true
            alert(`恭喜您獲得${point}分`)
            alert(`你的確率統計:\n
            perfect:${perfect}次\n
            excellent:${perfect}次\n
            good:${good}次`)
            if (storage == null || point > hscore.score) {

                const input = prompt('恭喜最高分，請輸入名字')
                if (input != null && input.trim() != '') {

                    hscore.score = point
                    hscore.name = input

                    hscoreborad.innerText = hscore.score
                    hplayerborad.innerText = hscore.name

                    localStorage.setItem('hscore', JSON.stringify(hscore))
                }
            }
        }

        // 鍵盤點擊-----------------------------------------------------------
        window.onkeydown = (event) => {
            const x = event.key.toUpperCase()
            if (x == 'A' || x == 'S' || x == 'D' || x == '4' || x == '5' || x == '6') {
                let i = keyboard.indexOf(`${x}`)
                // console.log(x + "," + event.timeStamp)
                btns[i].click()
            }

            if (x == 'ENTER') {
                start.click()
                // console.log(A)
                // console.log(S)
                // console.log(D)
                // console.log(num4)
                // console.log(num5)
                // console.log(num6)
                // console.log(xA)
                // console.log(xS)
                // console.log(xD)
                // console.log(xnum4)
                // console.log(xnum5)
                // console.log(xnum6)
                // console.log(xxA)
                // console.log(xxS)
                // console.log(xxD)
                // console.log(xxnum4)
                // console.log(xxnum5)
                // console.log(xxnum6)
            }
            // 創作者模式--------------------------------------------
            // switch (x) {
            //     case 'A':
            //         if (A.length < 100) {
            //             A.push(Math.round(event.timeStamp))
            //             break;
            //         }
            //         else {
            //             if (xA.length < 100) {
            //                 xA.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //             else {
            //                 xxA.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //         }
            //     case 'S':
            //         if (S.length < 100) {
            //             S.push(Math.round(event.timeStamp))
            //             break;
            //         }
            //         else {
            //             if (xS.length < 100) {
            //                 xS.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //             else {
            //                 xxS.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //         }
            //     case 'D':
            //         if (D.length < 100) {
            //             D.push(Math.round(event.timeStamp))
            //             break;
            //         }
            //         else {
            //             if (xD.length < 100) {
            //                 xD.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //             else {
            //                 xxD.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //         }
            //     case '4':
            //         if (num4.length < 100) {
            //             num4.push(Math.round(event.timeStamp))
            //             break;
            //         }
            //         else {
            //             if (xnum4.length < 100) {
            //                 xnum4.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //             else {
            //                 xxnum4.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //         }

            //     case '5':
            //         if (num5.length < 100) {
            //             num5.push(Math.round(event.timeStamp))
            //             break;
            //         }
            //         else {
            //             if (xnum5.length < 100) {
            //                 xnum5.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //             else {
            //                 xxnum5.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //         }

            //     case '6':
            //         if (num6.length < 100) {
            //             num6.push(Math.round(event.timeStamp))
            //             break;
            //         }
            //         else {
            //             if (xnum5.length < 100) {
            //                 xnum5.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //             else {
            //                 xxnum6.push(Math.round(event.timeStamp))
            //                 break;
            //             }
            //         }
            // }
        }
        // 譜面-----------------------------------------------------------

        let A = [10498, 13674, 16706, 16906, 20098, 23322, 24866, 26450, 28650, 29722, 31234, 32890, 35098, 36082, 37642, 39258, 41498, 42482, 44042, 45650, 47938, 48897, 51282, 52873, 55266, 57634, 60098, 62506, 64209, 65057, 68266, 71345, 73657, 76049, 78489, 80961, 83306, 85793, 88129, 90369, 92753, 95161, 96898, 99161, 101281, 103697, 106113, 108489, 112089, 114449, 119345, 121921, 123689, 126393, 129137, 131625, 133449, 136097, 138665, 141385, 143209, 145145, 148985, 150993, 152945, 156593]
        let S = [11954, 15218, 16618, 18418, 21674, 23618, 25178, 26802, 28370, 30050, 31586, 33210, 34802, 36402, 37978, 39578, 41194, 42834, 44362, 45986, 47601, 50514, 53650, 56810, 59313, 63353, 66682, 69841, 72161, 74474, 76857, 79305, 82449, 84153, 86681, 88833, 91209, 93633, 97657, 100177, 104905, 110929, 116793, 121081, 124593, 128217, 130801, 134337, 136977, 140489, 146177, 147129, 151937, 153825, 155681, 157521]
        let D = [13298, 16546, 19730, 22458, 23898, 25490, 27074, 28018, 30282, 31914, 33522, 34498, 36730, 38274, 39898, 40850, 43114, 44681, 46297, 47274, 49730, 52106, 54450, 56034, 58465, 60881, 61657, 65897, 67481, 69089, 70553, 72889, 75233, 77673, 80130, 81745, 85001, 87409, 89609, 92001, 94433, 96009, 98401, 102465, 107249, 109713, 113297, 115705, 118041, 120193, 122761, 125465, 127289, 129937, 132561, 135209, 137817, 139553, 142249, 144153, 148137, 150009, 154841]
        let num4 = [4643, 5483, 5707, 6019, 7131, 7907, 8675, 8899, 9235, 11098, 11859, 12091, 12419, 13451, 14339, 15043, 15323, 15659, 17475, 18227, 18499, 18827, 19851, 20699, 21491, 21715, 22051, 23899, 24611, 24939, 25235, 26163, 27083, 27803, 28115, 28427, 30283, 31043, 31315, 31627, 32691, 33523, 34259, 34531, 34827, 36715, 37483, 37715, 38027, 39075, 39939, 40667, 40915, 41219, 43107, 43843, 44131, 44483, 45419, 46267, 46995, 47339, 47635, 48987, 51715, 54491, 59722, 61802, 62082, 64555, 67394, 74563, 77322, 80098, 87418, 90138, 93074, 100291, 100450, 101170, 101826, 103730, 104898, 105099, 105890, 106602, 108578, 109738, 109922, 110674, 113338, 114530, 114730, 115514, 119354, 119546, 120290, 122330, 124202, 124402, 125138, 127362, 128890, 129082, 129850, 133034, 133818, 135674, 136571, 137418, 138538, 138738, 139594, 141794, 143314, 143506, 144298, 146514, 148090, 148258, 149106, 152226, 153978, 155754, 156914]
        let num5 = [3915, 4323, 5259, 6307, 6843, 7323, 7635, 8499, 9523, 9820, 10531, 10811, 11659, 12739, 13251, 13684, 14059, 14875, 15971, 16243, 16899, 17211, 18035, 19147, 19627, 20139, 20419, 21267, 22339, 22635, 23363, 23643, 24443, 25499, 25995, 26507, 26819, 27579, 28747, 29043, 29771, 30019, 30851, 31923, 32459, 32931, 33251, 34075, 35131, 35427, 36147, 36451, 37283, 38323, 38868, 39338, 39691, 40483, 41539, 41827, 42538, 42835, 43674, 44787, 45258, 45732, 46019, 46835, 47915, 48259, 49243, 49699, 51915, 54690, 54916, 55403, 58315, 62298, 64738, 67578, 67794, 68187, 71242, 74818, 75283, 77498, 80330, 80539, 80954, 85706, 87690, 88146, 90306, 93210, 93418, 93826, 96842, 100578, 100954, 101338, 102378, 105274, 105658, 106074, 107731, 110058, 110482, 110938, 112690, 114874, 115306, 115722, 117666, 119722, 120098, 120530, 121706, 123658, 124546, 124930, 125370, 126666, 128194, 129202, 129634, 130074, 132018, 134346, 135242, 137002, 138162, 138938, 139346, 139794, 140778, 143698, 144098, 144522, 145722, 146914, 147666, 148458, 148890, 149330, 151274, 152962, 153786, 154154, 154522, 155338, 156578, 157738]
        let num6 = [5027, 6627, 8267, 10107, 11419, 13043, 14659, 16531, 17827, 19435, 21043, 22923, 24259, 25835, 27419, 29307, 30642, 32259, 33891, 35739, 37067, 38683, 40290, 42107, 43451, 45074, 46627, 48523, 49539, 52115, 55147, 60090, 62482, 64931, 67994, 70795, 75107, 77706, 80778, 84114, 85394, 87946, 90490, 93650, 96458, 100802, 103250, 104402, 105491, 107130, 110322, 112002, 114002, 115114, 116882, 119938, 121050, 122994, 124770, 125770, 129450, 130938, 134770, 136098, 137794, 139170, 140250, 143922, 145410, 147266, 148698, 150202, 153618, 154938, 156130, 157330]

        // let xA = []
        // let xS = []
        // let xD = []
        // let xnum4 = []
        // let xnum5 = []
        // let xnum6 = []

        // let xxA = []
        // let xxS = []
        // let xxD = []
        // let xxnum4 = []
        // let xxnum5 = []
        // let xxnum6 = []

        // let A = []
        // let S = []
        // let D = []
        // let num4 = []
        // let num5 = []
        // let num6 = []


        // let xA = []
        // let xS = []
        // let xD = []
        // let xnum4 = []
        // let xnum5 = []
        // let xnum6 = []

        // let xxA = []
        // let xxS = []
        // let xxD = []
        // let xxnum4 = []
        // let xxnum5 = []
        // let xxnum6 = []



    </script>
</body>

</html>